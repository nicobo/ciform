Crypto=typeof Crypto!="undefined"?Crypto:{};Crypto.Base64=(function(){var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function c(h){var f,m,k;var j="",d=0,i=0;var g=h.length;for(k=0;k<g;k++){m=h.charCodeAt(k);if(i==0){j+=b.charAt((m>>2)&63);f=(m&3)<<4}else{if(i==1){j+=b.charAt((f|(m>>4)&15));f=(m&15)<<2}else{if(i==2){j+=b.charAt(f|((m>>6)&3));d+=1;if((d%60)==0){j+="\n"}j+=b.charAt(m&63)}}}d+=1;if((d%60)==0){j+="\n"}i+=1;if(i==3){i=0}}if(i>0){j+=b.charAt(f);d+=1;if((d%60)==0){j+="\n"}j+="=";d+=1}if(i==1){if((d%60)==0){j+="\n"}j+="="}return j}function a(g){var k,j;var i="",h=0,d=0;var f=g.length;for(j=0;j<f;j++){k=b.indexOf(g.charAt(j));if(k>=0){if(h){i+=String.fromCharCode(d|(k>>(6-h))&255)}h=(h+2)&7;d=(k<<h)&255}}return i}return{s2r:c,r2s:a,}})();Crypto=typeof Crypto!="undefined"?Crypto:{};Crypto.Hex=(function(c,f){function b(q){var i=1,h=[0],l=0,k=0,o=256;var p=q.length*8;for(var j=0;j<p;j++){if((o<<=1)>255){o=1;var m=q.charCodeAt(k++)}if(i>f){i=1;h[++l]=0}if(m&o){h[l]|=i}i<<=1}return h}function g(p){var j=1,o=0,h=[0],i=1,m=0;var q=p.length*c;var k,l="";for(k=0;k<q;k++){if(p[o]&j){h[m]|=i}if((i<<=1)>255){i=1;h[++m]=0}if((j<<=1)>f){j=1;o++}}while(m>=0&&h[m]==0){m--}for(k=0;k<=m;k++){l+=String.fromCharCode(h[k])}return l}function d(k){var h="";for(var j=0;j<k.length;j++){var l=k.charCodeAt(j);h+=((l<16)?"0":"")+l.toString(16)}return h}function a(k){var j="";if(k.indexOf("0x")==0||k.indexOf("0X")==0){k=k.substr(2)}if(k.length%2){k+="0"}for(var h=0;h<k.length;h+=2){j+=String.fromCharCode(parseInt(k.slice(h,h+2),16))}return j}return{s2b:b,b2s:g,s2hex:d,hex2s:a}})(bs,bm);function $defined(a){return a!=null&&a!=undefined}function $(a){return typeof a=="object"?a:document.getElementById(a)}Object.prototype.extend=function(){for(var b=0;b<arguments.length;b++){if(typeof arguments[b]=="object"){for(var c in arguments[b]){this[c]=arguments[b][c]}}}return this};function merge(){var a=new Object();Object.extend.apply(a,arguments);return a}function equals(b,a,c){return(c&&typeof b=="string"&&typeof a=="string")?(b.toUpperCase()==a.toUpperCase()):(b==a)}Array.prototype.containsValue=function(b,c){var a=c?true:false;for(e in this){if(equals(this[e],b,a)){return true}}return false};HTMLElement.prototype.hasClass=function(a){return(" "+this.className+" ").indexOf(" "+a+" ")!=-1};HTMLElement.prototype.addClass=function(a){if(!this.hasClass(a)){this.className=this.className+" "+a}};HTMLElement.prototype.removeClass=function(a){if(this.hasClass(a)){this.className=(" "+this.className+" ").replace(" "+a+" ","")}};Thread={queue:[],execute:function(a){console.log(this);return this.queue[a]()}};function delay(c,g,f,b){var a=arguments;var d=Thread.queue.push(function(){f.apply(g,a)})-1;setTimeout("Thread.execute("+d+")",c)}Object.prototype.delay=function(b,c,a){b(b,this,c,a)};function refresh(c){var a=c.cloneNode(true);c.parentNode.replaceChild(a,c);a.parentNode.replaceChild(c,a)}Object.prototype.refresh=function(){refresh(this)};Crypto=typeof Crypto!="undefined"?Crypto:{};Crypto.RSA=(function(){var p=28;var v=1<<p,a=v-1,o=v>>1,i=p>>1,r=(1<<i)-1;var l=Math.log(2);function h(x,w){var z=x.length,C=w.length;if(z<C){return h(w,x)}var y=new Array(z);var B=0,A=0;for(;A<C;A++){B+=x[A]+w[A];y[A]=B&a;B>>>=p}for(;A<z;A++){B+=x[A];y[A]=B&a;B>>>=p}if(B){y[A]=B}return y}function u(x,w){var z=x.length,C=w.length;if(C>z){return[]}if(C==z){if(w[C-1]>x[C-1]){return[]}if(C==1){return[x[0]-w[0]]}}var y=new Array(z);var B=0;for(var A=0;A<C;A++){B+=x[A]-w[A];y[A]=B&a;B>>=p}for(;A<z;A++){B+=x[A];y[A]=B&a;B>>=p}if(B){return[]}if(y[A-1]){return y}while(A>1&&y[A-1]==0){A--}return y.slice(0,A)}function n(x){var w=new Array(x);while(x-->0){w[x]=0}return w}function k(K,J){J=J.concat([0]);var F=K.length,y=J.length;var z,L,x,I,A,E,H,D,C,G,B;var w=n(F+y+1);for(z=0;z<F;z++){x=K[z];if(x){I=0;C=x>>i;D=x&r;A=z;for(L=0;L<y;L++,A++){E=J[L];H=E>>i;E=E&r;G=E*C+D*H;B=G>>i;G&=r;I+=w[A]+D*E+(G<<i);w[A]=I&a;I=(I>>p)+H*C+B}}}z=w.length;if(w[z-1]){return w}while(z>1&&w[z-1]==0){z--}return w.slice(0,z)}function q(y,A,w){var z=0;while(A>=0&&w-->0){z=z*v+y[A--]}return z}function g(D,C){var I=D.length-1,F=C.length-1,E=I-F;if(I<F||I==F&&(D[I]<C[I]||I>0&&D[I]==C[I]&&D[I-1]<C[I-1])){this.q=[0];this.mod=D;return this}if(I==F&&q(D,F,2)/q(C,F,2)<4){var w=0,B;for(;;){B=u(D,C);if(B.length==0){break}D=B;w++}this.q=[w];this.mod=D;return this}var O,N;N=Math.floor(Math.log(C[F])/l)+1;O=p-N;if(O){D=D.concat();C=C.concat();for(M=F;M>0;M--){C[M]=((C[M]<<O)&a)|(C[M-1]>>N)}C[0]=(C[0]<<O)&a;if(D[I]&((a<<N)&a)){D[++I]=0;E++}for(M=I;M>0;M--){D[M]=((D[M]<<O)&a)|(D[M-1]>>N)}D[0]=(D[0]<<O)&a}var M,L,P;var H=n(E+1);var z=n(E).concat(C);for(;;){P=u(D,z);if(P.length==0){break}H[E]++;D=P}var K=C[F],G=q(C,F,2);for(M=I;M>F;M--){var J=M-F-1;if(M>=D.length){H[J]=1}else{if(D[M]==K){H[J]=a}else{H[J]=Math.floor(q(D,M,2)/K)}}var A=q(D,M,3);while(H[J]*G>A){H[J]--}z=z.slice(1);P=u(D,k([H[J]],z));if(P.length==0){H[J]--;P=u(D,k([H[J]],z))}D=P}if(O){for(M=0;M<D.length-1;M++){D[M]=(D[M]>>O)|((D[M+1]<<N)&a)}D[D.length-1]>>=O}I=H.length;while(I>1&&H[I-1]==0){I--}this.q=H.slice(0,I);I=D.length;while(I>1&&D[I-1]==0){I--}this.mod=D.slice(0,I);return this}function c(y,w){var A=0,x;for(var z=y.length-1;z>=0;z--){x=y[z];A=((x>>i)+(A<<i))%w;A=((x&r)+(A<<i))%w}return A}function m(y,w){if(w.length==1){if(y.length==1){return[y[0]%w[0]]}if(w[0]<r){return[c(y,w[0])]}}var x=new g(y,w);return x.mod}function d(F,B,I){var E=F.length-(B.length<<1);if(E>0){return d(F.slice(0,E).concat(d(F.slice(E),B,I)),B,I)}var H=B.length+1,G=B.length-1,C;var D=k(F.slice(G),I).slice(H);var A=F.slice(0,H);var y=k(D,B).slice(0,H);var w=u(A,y);if(w.length==0){A[H]=1;w=u(A,y)}for(var z=0;;z++){C=u(w,B);if(C.length==0){break}w=C;if(z>=3){return d(w,B,I)}}return w}function j(w,D,B){var z=[1],C,E,F=w.concat();var A=B.length*2;var G=new Array(A+1);G[A--]=1;for(;A>=0;A--){G[A]=0}G=new g(G,B).q;for(A=0;A<D.length;A++){for(E=1,C=0;C<p;C++,E<<=1){if(D[A]&E){z=d(k(z,F),B,G)}F=d(k(F,F),B,G)}}return z}function b(x,y,w){return j(x,y,w)}function t(w,D,C,B,x){var A=j(m(w,C),m(D,u(C,[1])),C);var z=j(m(w,B),m(D,u(B,[1])),B);var y=u(z,A);if(y.length==0){y=u(A,z);y=m(k(y,x),B);y=u(B,y)}else{y=m(k(y,x),B)}return h(k(y,C),A)}function s(F){var x=1,w=[0],A=0,D=256;var C,z=F.length;if(z<2){alert("string too short, not a MPI");return 0}var B=(z-2)*8;var E=F.charCodeAt(0)*256+F.charCodeAt(1);if(E>B||E<B-8){alert("not a MPI, bits="+E+",len="+B);return 0}for(var y=0;y<B;y++){if((D<<=1)>255){D=1;C=F.charCodeAt(--z)}if(x>a){x=1;w[++A]=0}if(C&D){w[A]|=x}x<<=1}return w}function f(D){var y=1,C=0,w=[0],x=1,B=0;var E=D.length*p;var z,A="";for(z=0;z<E;z++){if(D[C]&y){w[B]|=x}if((x<<=1)>255){x=1;w[++B]=0}if((y<<=1)>a){y=1;C++}}while(B&&w[B]==0){B--}y=256;for(E=8;E>0;E--){if(w[B]&(y>>=1)){break}}E+=B*8;A+=String.fromCharCode(E/256)+String.fromCharCode(E%256);if(E){for(z=B;z>=0;z--){A+=String.fromCharCode(w[z])}}return A}return{b2mpi:f,encrypt:b,decrypt:t}})();Crypto=typeof Crypto!="undefined"?Crypto:{};Crypto.SHA1=(function(){var p=0;var u="";var c=8;function k(v){return j(f(t(v),v.length*c))}function i(v){return n(f(t(v),v.length*c))}function d(v){return r(f(t(v),v.length*c))}function b(v,w){return j(g(v,w))}function h(v,w){return n(g(v,w))}function m(v,w){return r(g(v,w))}function a(){return k("abc")=="a9993e364706816aba3e25717850c26c9cd0d89d"}function f(K,E){K[E>>5]|=128<<(24-E%32);K[((E+64>>9)<<4)+15]=E;var L=Array(80);var J=1732584193;var I=-271733879;var H=-1732584194;var G=271733878;var F=-1009589776;for(var B=0;B<K.length;B+=16){var D=J;var C=I;var A=H;var z=G;var v=F;for(var y=0;y<80;y++){if(y<16){L[y]=K[B+y]}else{L[y]=o(L[y-3]^L[y-8]^L[y-14]^L[y-16],1)}var M=q(q(o(J,5),s(y,I,H,G)),q(q(F,L[y]),l(y)));F=G;G=H;H=o(I,30);I=J;J=M}J=q(J,D);I=q(I,C);H=q(H,A);G=q(G,z);F=q(F,v)}return Array(J,I,H,G,F)}function s(w,v,y,x){if(w<20){return(v&y)|((~v)&x)}if(w<40){return v^y^x}if(w<60){return(v&y)|(v&x)|(y&x)}return v^y^x}function l(v){return(v<20)?1518500249:(v<40)?1859775393:(v<60)?-1894007588:-899497514}function g(x,A){var z=t(x);if(z.length>16){z=f(z,x.length*c)}var v=Array(16),y=Array(16);for(var w=0;w<16;w++){v[w]=z[w]^909522486;y[w]=z[w]^1549556828}var B=f(v.concat(t(A)),512+A.length*c);return f(y.concat(B),512+160)}function q(v,A){var z=(v&65535)+(A&65535);var w=(v>>16)+(A>>16)+(z>>16);return(w<<16)|(z&65535)}function o(v,w){return(v<<w)|(v>>>(32-w))}function t(y){var x=Array();var v=(1<<c)-1;for(var w=0;w<y.length*c;w+=c){x[w>>5]|=(y.charCodeAt(w/c)&v)<<(32-c-w%32)}return x}function r(x){var y="";var v=(1<<c)-1;for(var w=0;w<x.length*32;w+=c){y+=String.fromCharCode((x[w>>5]>>>(32-c-w%32))&v)}return y}function j(x){var w=p?"0123456789ABCDEF":"0123456789abcdef";var y="";for(var v=0;v<x.length*4;v++){y+=w.charAt((x[v>>2]>>((3-v%4)*8+4))&15)+w.charAt((x[v>>2]>>((3-v%4)*8))&15)}return y}function n(y){var x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var A="";for(var w=0;w<y.length*4;w+=3){var z=(((y[w>>2]>>8*(3-w%4))&255)<<16)|(((y[w+1>>2]>>8*(3-(w+1)%4))&255)<<8)|((y[w+2>>2]>>8*(3-(w+2)%4))&255);for(var v=0;v<4;v++){if(w*8+v*6>y.length*32){A+=u}else{A+=x.charAt((z>>6*(3-v))&63)}}}return A}return{hex_sha:k,b64_sha1:i,str_sha1:d,hex_hmac_sha1:b,b64_hmac_sha1:h,str_hmac_sha1:m}})();(function(c,b,a){Ciform={};Ciform.protocol={};Ciform.protocol.prototype=new Object();Ciform.protocol.VERSION="0";Ciform.protocol.PACKET_PREFIX="ciform:";Ciform.Field=function(f,d){if(!c(d)){d=f}this.input=f instanceof HTMLElement?f:d.input;this.output=c(d.output)?d.output:this["input"];this.sha1=c(d.sha1)?d.sha1:0;this._ciphertext=null;this._commit=function(){this["input"].value="";this["output"].value=this._ciphertext}};Ciform.Field.prototype=new Object();Ciform.ciphers={};Ciform.ciphers.Encoder=function(){};Ciform.ciphers.Encoder.prototype.encode=function(d){return d};Ciform.ciphers.SHA1Encoder=function(d){this.preamble=false;this.extend(d)};Ciform.ciphers.SHA1Encoder.prototype=new Ciform.ciphers.Encoder();Ciform.ciphers.SHA1Encoder.prototype.encode=function(d){a.debug(this,"encode(",d,")");return(this["preamble"]?"sha1:b64:":"")+b.SHA1.b64_sha1(d)};Ciform.ciphers.RSAPublicKey=function(){this.type="rsa";this.size=Number;this.e=Array(Number);this.p=Array(Number);this.q=Array(Number);this.pq=Array(Number);this.mpi=Array(Number)};Ciform.ciphers.RSAEncoder=function(d){this.pubKey=null;this.preamble=false;this.salt=false;this.noPadding=false;this.extend(d);if(!c(this.pubKey)){throw new TypeError("The public key is required !")}if(this.pubKey.type!="rsa"){throw new TypeError("Type of public key must be 'rsa'")}if(!this.pubKey.pq||!this.pubKey.e){throw new TypeError("Public key is missing a field : both 'pq' and 'e' are required")}};Ciform.ciphers.RSAEncoder.prototype=new Ciform.ciphers.Encoder();Ciform.ciphers.RSAEncoder.prototype.SALT_MAX=9999;Ciform.ciphers.RSAEncoder.prototype.SALT_MIN=1;Ciform.ciphers.RSAEncoder.prototype._getMPI=function(){if(!this.pubKey.mpi){this.pubKey.mpi=b.Base64.s2r(b.RSA.b2mpi(this.pubKey.pq)+b.RSA.b2mpi([this.pubKey.e])).replace(/\n/,"")}return this.pubKey.mpi};Ciform.ciphers.RSAEncoder.prototype._getSalt=function(){return Math.floor(Math.random()*(this.SALT_MAX-this.SALT_MIN+1)+this.SALT_MIN)};Ciform.ciphers.RSAEncoder.prototype.maxLength=function(){var f=b.Base64.r2s(this._getMPI());var d=Math.floor((f.charCodeAt(0)*256+f.charCodeAt(1)+7)/8);var g=d-4;if(this.salt){g-=new Number(this.SALT_MAX).toString().length}a.debug(this,".maxLength()=",g);return g};Ciform.ciphers.RSAEncoder.prototype.encode=function(m){a.debug(this,"encode(",m,")");var k=new Array();var i=new Array();k=this.pubKey.pq;i=this.pubKey.e;var h=m;if(this.salt){var j=this._getSalt();a.debug("salt="+j);h="salt"+j+":"+m}var d=h+String.fromCharCode(1);var f=this.maxLength();if(!this.noPadding&&!this.salt&&d.length>f){throw new RangeError("Plain text length must be less than "+f+" characters")}var l=b.Hex.s2b(d);var g=b.RSA.encrypt(l,i,k);return(this.preamble?"rsa:0x":"")+b.Hex.s2hex(b.Hex.b2s(g))};Ciform.ciphers.ChainEncoder=function(d){this.encoders=d};Ciform.ciphers.ChainEncoder.prototype=new Ciform.ciphers.Encoder();Ciform.ciphers.ChainEncoder.prototype.encode=function(d){var f=d;for(var g=0;g<this.encoders.length;g++){f=this.encoders[g].encode(f)}return f};Ciform.ciphers.CiformPacketizer=function(){};Ciform.ciphers.CiformPacketizer.prototype=new Ciform.ciphers.Encoder();Ciform.ciphers.CiformPacketizer.prototype.encode=function(d){return new RegExp("^"+Ciform.protocol.PACKET_PREFIX+"(.*)").test(d)?d:Ciform.protocol.PACKET_PREFIX+d};Ciform.Cipher=function(f){a.debug("new Ciform.Cipher(",f,")");this.encoder=null;this.onerror=function(h,g){a.error(g);throw h};this.onEncryptionStart=function(h,g){a.debug(this,".onEncryptionStart(",h,g,")",new Date())};this.onEncryptionEnd=function(h,g){a.debug(this,".onEncryptionEnd(",h,g,")",new Date())};for(var d=0;d<arguments.length;d++){this.extend(arguments[d])}if(!this["encoder"]&&this["pubKey"]){this["encoder"]=new Ciform.ciphers.ChainEncoder([new Ciform.ciphers.RSAEncoder(merge({preamble:true,salt:true},this)),new Ciform.ciphers.CiformPacketizer()])}if(!this["encoder"]){throw new TypeError("The encoder is required !")}};Ciform.Cipher.prototype.encryptText=function(i,f){a.debug(this,".encryptText(",i,f,")");if(!c(f)){f=i}var g=merge(this,f);var h=g.encoder;var d=null;if(!(h instanceof Ciform.ciphers.ChainEncoder)||!(h.encoders[h.encoders.length-1] instanceof Ciform.ciphers.CiformPacketizer)){h=new Ciform.ciphers.ChainEncoder([g.encoder,new Ciform.ciphers.CiformPacketizer()])}try{this.onEncryptionStart(i,g);d=h.encode(i)}catch(h){this.onerror(h,g);d=null}finally{this.onEncryptionEnd(i,g)}return d};Ciform.Cipher.prototype.encryptField=function(k,f){a.debug(this,".encryptField(",k,f,")");if(!c(f)){f=k}var i=merge({commit:true},new Ciform.Field(k),f);var l=i.input.value;var g=i.output;var d=false;if(/ciform-sha1/.test(g.className)){i.sha1=2}else{if(/sha1/.test(g.className)){i.sha1=1}}this.onEncryptionStart(k,i);try{if(i.sha1){l=new Ciform.ciphers.SHA1Encoder({preamble:i.sha1==2}).encode(l)}var h=this.encryptText(l,i);if(h!=null){i._ciphertext=h;if(i.commit){i._commit();d=true}else{d=i}}else{d=false}}catch(j){this.onerror(j,i);d=false}finally{this.onEncryptionEnd(k,i)}return d};Ciform.Cipher.prototype.encryptFields=function(g,i){a.debug(this,".encryptFields(",g,i,")");var h=[];var d=false;try{this.onEncryptionStart(g,i);for(var j=0;j<g.length;j++){h[j]=this.encryptField(g[j],merge(i,{commit:false}));if(h[j]==false){this.onEncryptionEnd(g,i);return false}}for(var j=0;j<h.length;j++){h[j]._commit()}d=true}catch(k){this.onerror(k,i);d=false}finally{this.onEncryptionEnd(g,i)}return d};Ciform.Cipher.prototype.encryptForm=function(m,o){a.debug(this,".encryptForm(",m,o,")");if(!c(o)){o=m}var d=m instanceof HTMLFormElement?m:o.form;var i=merge({form:d},o);var j=new Array();j.extend(i.form.elements);var p=true;try{this.onEncryptionStart(m,i);var n=i.allowTypes;var h=i.rejectTypes;for(var k=0;k<j.length;k++){var g=j[k];if(g.tagName.toUpperCase()=="INPUT"&&g.type&&!["button","submit","image"].containsValue(g.type,true)&&!equals("disabled",g.disabled,true)&&!equals("readonly",g.readonly,true)){if(n&&!n.containsValue(g.type,true)){j.splice(k,1)}else{if(h&&h.containsValue(g.type,true)){j.splice(k,1)}}}else{j.splice(k,1)}}p=this.encryptFields(j,i)}catch(l){this.onerror(l,i);p=false}finally{this.onEncryptionEnd(m,i)}return p};Ciform.Cipher.prototype.encryptURL=function(d,o){a.debug(this,".encryptURL(",d,o,")");var f=d;try{this.onEncryptionStart(d,o);var j=/([^\?]*)\?(.*)/.exec(d);if(j&&j.length>=3){f=j[1]+"?";var i=j[2].split(/&/);for(var l=0;l<i.length;l++){var k=/([^=]*)=?(.*)/.exec(i[l]);if(k[1]){var n=k[1];var g=k[2];f+=n;if(g){var m=!o.fields||o.fields[n];f+="="+(m?this.encryptText(g):g)}}if(l+1<i.length){f+="&"}}}}catch(h){this.onerror(h,o)}finally{this.onEncryptionEnd(d,o)}return f}})($defined,Crypto,console);