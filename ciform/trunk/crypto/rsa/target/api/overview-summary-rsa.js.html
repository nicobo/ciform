<!doctype html public "-//W3C//DTD HTML 4.0 Frameset//EN""http://www.w3.org/TR/REC-html40/frameset.dtd">
<html>
<head>
<title>
Crypto.RSA Overview
</title>
<link rel ="stylesheet" type="text/css" href="stylesheet.css" title="Style">
<script>
function asd() {
	
		parent.document.title="rsa.js Overview";
	
}
</script>
</head>
<body bgcolor="white" onload="asd();">

<!-- ========== START OF NAVBAR ========== -->
<a name="navbar_top"><!-- --></a>
<table border="0" width="100%" cellpadding="1" cellspacing="0">
<tr>
<td colspan=2 bgcolor="#EEEEFF" class="NavBarCell1">
<a name="navbar_top_firstrow"><!-- --></a>
<table border="0" cellpadding="0" cellspacing="3">
  <tr align="center" valign="top">
  
  
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="overview-summary.html"><font class="NavBarFont1"><b>Overview</b></font></a>&nbsp;</td>
  <td bgcolor="#FFFFFF" class="NavBarCell1Rev">	&nbsp;<font class="NavBarFont1Rev"><b>File</b></font>&nbsp;</td>
  

  <td bgcolor="#FFFFFF" class="NavBarCell1"> 	<font class="NavBarFont1">Class</font>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="overview-tree.html"><font class="NavBarFont1"><b>Tree</b></font></a>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="index-all.html"--><font class="NavBarFont1"><b>Index</b></font></a>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="help-doc.html"><font class="NavBarFont1"><b>Help</b></font></a>&nbsp;</td>
  </tr>
</table>
</td>
<td bgcolor="#EEEEFF" align="right" valign="top">
<em>
<b>Crypto.RSA</b></em>
</td>
</tr>

<tr>
<td bgcolor="white" class="NavBarCell2"><font size="-2">
&nbsp;PREV&nbsp;
&nbsp;NEXT</font></td>
<td bgcolor="white" class="NavBarCell2"><font size="-2">
  <a href="index.html" target="_top"><b>FRAMES</b></a>  &nbsp;
&nbsp;<a href="overview-summary.html" target="_top"><b>NO FRAMES</b></a>
&nbsp;&nbsp;
<script>
  <!--
  if(window==top) {
    document.writeln('<A HREF="allclasses-noframe.html" TARGET=""><B>All Classes</B></A>');
  }
  //-->
</script>
<noscript>
<a href="allclasses-noframe.html" target=""><b>All Classes</b></a>
</noscript>
</font></td>
</tr>
</table>
<!-- =========== END OF NAVBAR =========== -->

<hr>
<center>
	
	   <h2>rsa.js</h2>
	
</center>

	


<h4>Summary</h4>
<p>
	
		No overview generated for 'rsa.js'<BR/><BR/>
	
</p>

<hr>


    <table border="1" cellpadding="3" cellspacing="0" width="100%">
    <tr bgcolor="#CCCCFF" class="TableHeadingColor">
    <td colspan=2><font size="+2">
    
        <b>Class Summary</b>
    
    </font></td>
    </tr>
    
    <tr bgcolor="white" class="TableRowColor">
    <td width="15%"><b><a href="bdiv.html">bdiv</a></b></td>
    <td>&nbsp;</td>
    </tr>
    
    </table>
    <hr/> 


<!-- ========== METHOD SUMMARY =========== -->

	<a name="method_summary"><!-- --></a>
	<table border="1" cellpadding="3" cellspacing="0" width="100%">
		<tr bgcolor="#CCCCFF" class="TableHeadingColor">
			<td colspan=2>
				<font size="+2">
					<b>Method Summary</b>
				</font>
			</td>
		</tr>
	
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!b2mpi">b2mpi</a></b>(b)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!badd">badd</a></b>(a,b)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!bmod">bmod</a></b>(p,m)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!bmod2">bmod2</a></b>(x,m,mu)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!bmodexp">bmodexp</a></b>(xx,y,m)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!bmul">bmul</a></b>(a,b)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!bsub">bsub</a></b>(a,b)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!mpi2b">mpi2b</a></b>(s)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!RSAdecrypt">RSAdecrypt</a></b>(m, d, p, q, u)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!RSAencrypt">RSAencrypt</a></b>(s, e, m)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!simplemod">simplemod</a></b>(i,m)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!toppart">toppart</a></b>(x,start,len)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!zeros">zeros</a></b>(n)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
	
	</table>
    <p>

<!-- ========== END METHOD SUMMARY =========== -->


        <pre class="sourceview">
<span class="comment">/* RSA public key encryption/decryption
 * The following functions are (c) 2000 by John M Hanna and are
 * released under the terms of the Gnu Public License.
 * You must freely redistribute them with their source -- see the
 * GPL for details.
 *  -- Latest version found at http://sourceforge.net/projects/shop-js
 *
 * GnuPG multi precision integer (mpi) conversion added
 * 2004 by Herbert Hanewinkel, www.haneWIN.de
 */</span>

<span class="comment">// --- Arbitrary Precision Math ---</span>
<span class="comment">// badd(a,b), bsub(a,b), bmul(a,b)</span>
<span class="comment">// bdiv(a,b), bmod(a,b), bmodexp(xx,y,m)</span>

<span class="comment">// set the base... 32bit cpu -&gt; bs=16, 64bit -&gt; bs=32</span>
<span class="comment">// bs is the shift, bm is the mask</span>

var bs=28;
var bx2=1&lt;&lt;bs, bm=bx2-1, bx=bx2&gt;&gt;1, bd=bs&gt;&gt;1, bdm=(1&lt;&lt;bd)-1;

var log2=Math.log(2);

<span class="reserved">function</span> badd(a,b) <span class="comment">// binary add</span>
{
 var al=a.length, bl=b.length;

 <span class="reserved">if</span>(al &lt; bl) <span class="reserved">return</span> badd(b,a);

 var r=new Array(al);
 var c=0, n=0;

 <span class="reserved">for</span>(; n&lt;bl; n++)
 {
  c+=a[n]+b[n];
  r[n]=c &amp; bm;
  c&gt;&gt;&gt;=bs;
 }
 <span class="reserved">for</span>(; n&lt;al; n++)
 {
  c+=a[n];
  r[n]=c &amp; bm;
  c&gt;&gt;&gt;=bs;
 }
 <span class="reserved">if</span>(c) r[n]=c;
 <span class="reserved">return</span> r;
}

<span class="reserved">function</span> bsub(a,b) <span class="comment">// binary subtract</span>
{
 var al=a.length, bl=b.length;

 <span class="reserved">if</span>(bl &gt; al) <span class="reserved">return</span> [];
 <span class="reserved">if</span>(bl == al)
 {
  <span class="reserved">if</span>(b[bl-1] &gt; a[bl-1]) <span class="reserved">return</span> [];
  <span class="reserved">if</span>(bl==1) <span class="reserved">return</span> [a[0]-b[0]];
 }

 var r=new Array(al);
 var c=0;

 <span class="reserved">for</span>(var n=0; n&lt;bl; n++)
 {
  c+=a[n]-b[n];
  r[n]=c &amp; bm;
  c&gt;&gt;=bs;
 }
 <span class="reserved">for</span>(;n&lt;al; n++)
 {
  c+=a[n];
  r[n]=c &amp; bm;
  c&gt;&gt;=bs;
 }
 <span class="reserved">if</span>(c) <span class="reserved">return</span> [];

 <span class="reserved">if</span>(r[n-1]) <span class="reserved">return</span> r;
 <span class="reserved">while</span>(n&gt;1 &amp;&amp; r[n-1]==0) n--;
 <span class="reserved">return</span> r.slice(0,n);
}

<span class="reserved">function</span> zeros(n)
{
 var r=new Array(n);

 <span class="reserved">while</span>(n--&gt;0) r[n]=0;
 <span class="reserved">return</span> r;
}

<span class="reserved">function</span> bmul(a,b) <span class="comment">// binary multiply</span>
{
 b=b.concat([0]);
 var al=a.length, bl=b.length;
 var n,nn,aa,c,m, g,gg,h,hh,ghh,ghhb;

 var r=zeros(al+bl+1);

 <span class="reserved">for</span>(n=0; n&lt;al; n++)
 {
  aa=a[n];
  <span class="reserved">if</span>(aa)
  {
   c=0;
   hh=aa&gt;&gt;bd; h=aa &amp; bdm;
   m=n;
   <span class="reserved">for</span>(nn=0; nn&lt;bl; nn++, m++)
   {
    g = b[nn]; gg=g&gt;&gt;bd; g=g &amp; bdm;
    <span class="comment">// (gg*2^15 + g) * (hh*2^15 + h) = (gghh*2^30 + (ghh+hgg)*2^15 +hg)</span>
    ghh = g * hh + h * gg;
    ghhb= ghh &gt;&gt; bd; ghh &amp;= bdm;
    c += r[m] + h * g + (ghh &lt;&lt; bd);
    r[m] = c &amp; bm;
    c = (c &gt;&gt; bs) + gg * hh + ghhb;
   }
  }
 }
 n=r.length;

 <span class="reserved">if</span>(r[n-1]) <span class="reserved">return</span> r;
 <span class="reserved">while</span>(n&gt;1 &amp;&amp; r[n-1]==0) n--;
 <span class="reserved">return</span> r.slice(0,n);
}

<span class="reserved">function</span> toppart(x,start,len)
{
 var n=0;
 <span class="reserved">while</span>(start &gt;= 0 &amp;&amp; len--&gt;0) n=n*bx2+x[start--];
 <span class="reserved">return</span> n;
}

<span class="comment">// ----------------------------------------------------</span>
<span class="comment">// 14.20 Algorithm Multiple-precision division from HAC</span>

<span class="reserved">function</span> bdiv(x,y)
{
 var n=x.length-1, t=y.length-1, nmt=n-t;

 <span class="comment">// trivial cases; x &lt; y</span>
 <span class="reserved">if</span>(n &lt; t || n==t &amp;&amp; (x[n]&lt;y[n] || n&gt;0 &amp;&amp; x[n]==y[n] &amp;&amp; x[n-1]&lt;y[n-1]))
 {
  <span class="reserved">this</span>.q=[0]; <span class="reserved">this</span>.mod=x;
  <span class="reserved">return</span> <span class="reserved">this</span>;
 }

 <span class="comment">// trivial cases; q &lt; 4</span>
 <span class="reserved">if</span>(n==t &amp;&amp; toppart(x,t,2)/toppart(y,t,2) &lt;4)
 {
  var qq=0, xx;
  <span class="reserved">for</span>(;;)
  {
   xx=bsub(x,y);
   <span class="reserved">if</span>(xx.length==0) break;
   x=xx; qq++;
  }
  <span class="reserved">this</span>.q=[qq]; <span class="reserved">this</span>.mod=x;
  <span class="reserved">return</span> <span class="reserved">this</span>;
 }

 var shift, shift2
 <span class="comment">// normalize</span>
 shift2=Math.floor(Math.log(y[t])/log2)+1;
 shift=bs-shift2;
 <span class="reserved">if</span>(shift)
 {
  x=x.concat(); y=y.concat()
  <span class="reserved">for</span>(i=t; i&gt;0; i--) y[i]=((y[i]&lt;&lt;shift) &amp; bm) | (y[i-1] &gt;&gt; shift2);
  y[0]=(y[0]&lt;&lt;shift) &amp; bm;
  <span class="reserved">if</span>(x[n] &amp; ((bm &lt;&lt;shift2) &amp; bm))
  {
   x[++n]=0; nmt++;
  }
  <span class="reserved">for</span>(i=n; i&gt;0; i--) x[i]=((x[i]&lt;&lt;shift) &amp; bm) | (x[i-1] &gt;&gt; shift2);
  x[0]=(x[0]&lt;&lt;shift) &amp; bm;
 }

 var i, j, x2;
 var q=zeros(nmt+1);
 var y2=zeros(nmt).concat(y);
 <span class="reserved">for</span>(;;)
 {
  x2=bsub(x,y2);
  <span class="reserved">if</span>(x2.length==0) break;
  q[nmt]++;
  x=x2;
 }

 var yt=y[t], top=toppart(y,t,2)
 <span class="reserved">for</span>(i=n; i&gt;t; i--)
 {
  var m=i-t-1;
  <span class="reserved">if</span>(i &gt;= x.length) q[m]=1;
  <span class="reserved">else</span> <span class="reserved">if</span>(x[i] == yt) q[m]=bm;
  <span class="reserved">else</span> q[m]=Math.floor(toppart(x,i,2)/yt);

  var topx=toppart(x,i,3);
  <span class="reserved">while</span>(q[m] * top &gt; topx) q[m]--;

  <span class="comment">//x-=q[m]*y*b^m</span>
  y2=y2.slice(1);
  x2=bsub(x,bmul([q[m]],y2));
  <span class="reserved">if</span>(x2.length==0)
  {
   q[m]--;
   x2=bsub(x,bmul([q[m]],y2));
  }
  x=x2;
 }
 <span class="comment">// de-normalize</span>
 <span class="reserved">if</span>(shift)
 {
  <span class="reserved">for</span>(i=0; i&lt;x.length-1; i++) x[i]=(x[i]&gt;&gt;shift) | ((x[i+1] &lt;&lt; shift2) &amp; bm);
  x[x.length-1]&gt;&gt;=shift;
 }
 n = q.length;
 <span class="reserved">while</span>(n &gt; 1 &amp;&amp; q[n-1]==0) n--;
 <span class="reserved">this</span>.q=q.slice(0,n);
 n = x.length;
 <span class="reserved">while</span>(n &gt; 1 &amp;&amp; x[n-1]==0) n--;
 <span class="reserved">this</span>.mod=x.slice(0,n);
 <span class="reserved">return</span> <span class="reserved">this</span>;
}

<span class="reserved">function</span> simplemod(i,m) <span class="comment">// returns the mod where m &lt; 2^bd</span>
{
 var c=0, v;
 <span class="reserved">for</span>(var n=i.length-1; n&gt;=0; n--)
 {
  v=i[n];
  c=((v &gt;&gt; bd) + (c&lt;&lt;bd)) % m;
  c=((v &amp; bdm) + (c&lt;&lt;bd)) % m;
 }
 <span class="reserved">return</span> c;
}

<span class="reserved">function</span> bmod(p,m) <span class="comment">// binary modulo</span>
{
 <span class="reserved">if</span>(m.length==1)
 {
  <span class="reserved">if</span>(p.length==1) <span class="reserved">return</span> [p[0] % m[0]];
  <span class="reserved">if</span>(m[0] &lt; bdm) <span class="reserved">return</span> [simplemod(p,m[0])];
 }

 var r=new bdiv(p,m);
 <span class="reserved">return</span> r.mod;
}

<span class="comment">// ------------------------------------------------------</span>
<span class="comment">// Barrett's modular reduction from HAC, 14.42, CRC Press</span>

<span class="reserved">function</span> bmod2(x,m,mu)
{
 var xl=x.length - (m.length &lt;&lt; 1);
 <span class="reserved">if</span>(xl &gt; 0) <span class="reserved">return</span> bmod2(x.slice(0,xl).concat(bmod2(x.slice(xl),m,mu)),m,mu);

 var ml1=m.length+1, ml2=m.length-1,rr;
 <span class="comment">//var q1=x.slice(ml2)</span>
 <span class="comment">//var q2=bmul(q1,mu)</span>
 var q3=bmul(x.slice(ml2),mu).slice(ml1);
 var r1=x.slice(0,ml1);
 var r2=bmul(q3,m).slice(0,ml1);
 var r=bsub(r1,r2);
 <span class="comment">//var s=('x='+x+'\nm='+m+'\nmu='+mu+'\nq1='+q1+'\nq2='+q2+'\nq3='+q3+'\nr1='+r1+'\nr2='+r2+'\nr='+r); </span>
 <span class="reserved">if</span>(r.length==0)
 {
  r1[ml1]=1;
  r=bsub(r1,r2);
 }
 <span class="reserved">for</span>(var n=0;;n++)
 {
  rr=bsub(r,m);
  <span class="reserved">if</span>(rr.length==0) break;
  r=rr;
  <span class="reserved">if</span>(n&gt;=3) <span class="reserved">return</span> bmod2(r,m,mu);
 }
 <span class="reserved">return</span> r;
}

<span class="reserved">function</span> bmodexp(xx,y,m) <span class="comment">// binary modular exponentiation</span>
{
 var r=[1], an,a, x=xx.concat();
 var n=m.length*2;
 var mu=new Array(n+1);

 mu[n--]=1;
 <span class="reserved">for</span>(; n&gt;=0; n--) mu[n]=0; mu=new bdiv(mu,m).q;

 <span class="reserved">for</span>(n=0; n&lt;y.length; n++)
 {
  <span class="reserved">for</span>(a=1, an=0; an&lt;bs; an++, a&lt;&lt;=1)
  {
   <span class="reserved">if</span>(y[n] &amp; a) r=bmod2(bmul(r,x),m,mu);
   x=bmod2(bmul(x,x),m,mu);
  }
 }
 <span class="reserved">return</span> r;
}

<span class="comment">// -----------------------------------------------------</span>
<span class="comment">// Compute s**e mod m for RSA public key operation</span>

<span class="reserved">function</span> RSAencrypt(s, e, m) { <span class="reserved">return</span> bmodexp(s,e,m); }

<span class="comment">// Compute m**d mod p*q for RSA private key operations.</span>

<span class="reserved">function</span> RSAdecrypt(m, d, p, q, u)
{
 var xp = bmodexp(bmod(m,p), bmod(d,bsub(p,[1])), p);
 var xq = bmodexp(bmod(m,q), bmod(d,bsub(q,[1])), q);

 var t=bsub(xq,xp);
 <span class="reserved">if</span>(t.length==0)
 {
  t=bsub(xp,xq);
  t=bmod(bmul(t, u), q);
  t=bsub(q,t);
 }
 <span class="reserved">else</span>
 {
  t=bmod(bmul(t, u), q);
 } 
 <span class="reserved">return</span> badd(bmul(t,p), xp);
}

<span class="comment">// -----------------------------------------------------------------</span>
<span class="comment">// conversion functions: num array &lt;-&gt; multi precision integer (mpi)</span>
<span class="comment">// mpi: 2 octets with length in bits + octets in big endian order</span>

<span class="reserved">function</span> mpi2b(s)
{
 var bn=1, r=[0], rn=0, sb=256;
 var c, sn=s.length;
 <span class="reserved">if</span>(sn &lt; 2)
 {
    alert(<span class="literal">'string too short, not a MPI'</span>);
    <span class="reserved">return</span> 0;
 }

 var len=(sn-2)*8;
 var bits=s.charCodeAt(0)*256+s.charCodeAt(1);
 <span class="reserved">if</span>(bits &gt; len || bits &lt; len-8) 
 {
    alert(<span class="literal">'not a MPI, bits='</span>+bits+<span class="literal">",len="</span>+len);
    <span class="reserved">return</span> 0;
 }

 <span class="reserved">for</span>(var n=0; n&lt;len; n++)
 {
  <span class="reserved">if</span>((sb&lt;&lt;=1) &gt; 255)
  {
   sb=1; c=s.charCodeAt(--sn);
  }
  <span class="reserved">if</span>(bn &gt; bm)
  {
   bn=1;
   r[++rn]=0;
  }
  <span class="reserved">if</span>(c &amp; sb) r[rn]|=bn;
  bn&lt;&lt;=1;
 }
 <span class="reserved">return</span> r;
}

<span class="reserved">function</span> b2mpi(b)
{
 var bn=1, bc=0, r=[0], rb=1, rn=0;
 var bits=b.length*bs;
 var n, rr=<span class="literal">''</span>;

 <span class="reserved">for</span>(n=0; n&lt;bits; n++)
 {
  <span class="reserved">if</span>(b[bc] &amp; bn) r[rn]|=rb;
  <span class="reserved">if</span>((rb&lt;&lt;=1) &gt; 255)
  {
   rb=1; r[++rn]=0;
  }
  <span class="reserved">if</span>((bn&lt;&lt;=1) &gt; bm)
  {
   bn=1; bc++;
  }
 }

 <span class="reserved">while</span>(rn &amp;&amp; r[rn]==0) rn--;

 bn=256;
 <span class="reserved">for</span>(bits=8; bits&gt;0; bits--) <span class="reserved">if</span>(r[rn] &amp; (bn&gt;&gt;=1)) break;
 bits+=rn*8;

 rr+=String.fromCharCode(bits/256)+String.fromCharCode(bits%256);
 <span class="reserved">if</span>(bits) <span class="reserved">for</span>(n=rn; n&gt;=0; n--) rr+=String.fromCharCode(r[n]);
 <span class="reserved">return</span> rr;
}

</pre>
	<hr>



<!-- ========== START OF NAVBAR ========== -->
<a name="navbar_top"><!-- --></a>
<table border="0" width="100%" cellpadding="1" cellspacing="0">
<tr>
<td colspan=2 bgcolor="#EEEEFF" class="NavBarCell1">
<a name="navbar_top_firstrow"><!-- --></a>
<table border="0" cellpadding="0" cellspacing="3">
  <tr align="center" valign="top">
  
  
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="overview-summary.html"><font class="NavBarFont1"><b>Overview</b></font></a>&nbsp;</td>
  <td bgcolor="#FFFFFF" class="NavBarCell1Rev">	&nbsp;<font class="NavBarFont1Rev"><b>File</b></font>&nbsp;</td>
  

  <td bgcolor="#FFFFFF" class="NavBarCell1"> <font class="NavBarFont1">Class</font>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="overview-tree.html"><font class="NavBarFont1"><b>Tree</b></font></a>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="index-all.html"--><font class="NavBarFont1"><b>Index</b></font></a>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="help-doc.html"><font class="NavBarFont1"><b>Help</b></font></a>&nbsp;</td>
  </tr>
</table>
</td>
<td bgcolor="#EEEEFF" align="right" valign="top"><em>
<b>Crypto.RSA</b></em>
</td>
</tr>

<tr>
<td bgcolor="white" class="NavBarCell2"><font size="-2">
&nbsp;PREV&nbsp;
&nbsp;NEXT</font></td>
<td bgcolor="white" class="NavBarCell2"><font size="-2">
  <a href="index.html" target="_top"><b>FRAMES</b></a>  &nbsp;
&nbsp;<a href="overview-summary.html" target="_top"><b>NO FRAMES</b></a>
&nbsp;&nbsp;
<script>
  <!--
  if(window==top) {
    document.writeln('<A HREF="allclasses-noframe.html" TARGET=""><B>All Classes</B></A>');
  }
  //-->
</script>
<noscript>
<a href="allclasses-noframe.html" target=""><b>All Classes</b></a>
</noscript>
</font></td>
</tr>
</table>
<!-- =========== END OF NAVBAR =========== -->

<hr>
<font size="-1">

</font>
<div class="jsdoc_ctime">Documentation generated by <a href="http://jsdoc.sourceforge.net/" target="_parent">JSDoc</a> on Mon Aug 25 00:43:21 2008</div>
</body>
</html>
